<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€§èƒ½åŸºå‡†æµ‹è¯• - Tauri WebView2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            color: #718096;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .test-section {
            margin-bottom: 40px;
            padding: 24px;
            background: #f7fafc;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
        }

        .test-section h2 {
            color: #2d3748;
            margin-bottom: 16px;
            font-size: 24px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .metric-label {
            color: #718096;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .metric-value {
            color: #2d3748;
            font-size: 28px;
            font-weight: bold;
        }

        .metric-unit {
            color: #a0aec0;
            font-size: 16px;
            margin-left: 4px;
        }

        .metric-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }

        .status-excellent {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-good {
            background: #bee3f8;
            color: #2c5282;
        }

        .status-warning {
            background: #feebc8;
            color: #7c2d12;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 12px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-secondary:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .log-container {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 4px 0;
        }

        .log-time {
            color: #90cdf4;
        }

        .log-info {
            color: #68d391;
        }

        .log-warning {
            color: #f6ad55;
        }

        .log-error {
            color: #fc8181;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .comparison-table th {
            background: #edf2f7;
            color: #2d3748;
            font-weight: 600;
        }

        .comparison-table tr:hover {
            background: #f7fafc;
        }

        .better {
            color: #38a169;
            font-weight: 600;
        }

        .worse {
            color: #e53e3e;
            font-weight: 600;
        }

        #testCanvas {
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš¡ æ€§èƒ½åŸºå‡†æµ‹è¯•</h1>
        <p class="subtitle">Tauri WebView2 vs Electron - Windows å¹³å°</p>

        <!-- ç³»ç»Ÿä¿¡æ¯ -->
        <div class="test-section">
            <h2>ğŸ“Š ç³»ç»Ÿä¿¡æ¯</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">å¹³å°</div>
                    <div class="metric-value" id="platform">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">ç”¨æˆ·ä»£ç†</div>
                    <div class="metric-value" style="font-size: 14px;" id="userAgent">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">å†…å­˜é™åˆ¶</div>
                    <div class="metric-value" id="memoryLimit">-</div>
                    <span class="metric-unit">MB</span>
                </div>
                <div class="metric-card">
                    <div class="metric-label">CPU æ ¸å¿ƒæ•°</div>
                    <div class="metric-value" id="cpuCores">-</div>
                </div>
            </div>
        </div>

        <!-- å¯åŠ¨æ€§èƒ½ -->
        <div class="test-section">
            <h2>ğŸš€ å¯åŠ¨æ€§èƒ½</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">é¡µé¢åŠ è½½æ—¶é—´</div>
                    <div class="metric-value" id="loadTime">-</div>
                    <span class="metric-unit">ms</span>
                    <div class="metric-status status-excellent" id="loadTimeStatus">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">DOM å°±ç»ªæ—¶é—´</div>
                    <div class="metric-value" id="domReady">-</div>
                    <span class="metric-unit">ms</span>
                </div>
                <div class="metric-card">
                    <div class="metric-label">é¦–æ¬¡æ¸²æŸ“æ—¶é—´</div>
                    <div class="metric-value" id="firstPaint">-</div>
                    <span class="metric-unit">ms</span>
                </div>
                <div class="metric-card">
                    <div class="metric-label">é¦–æ¬¡å†…å®¹æ¸²æŸ“</div>
                    <div class="metric-value" id="firstContentfulPaint">-</div>
                    <span class="metric-unit">ms</span>
                </div>
            </div>
        </div>

        <!-- å†…å­˜ä½¿ç”¨ -->
        <div class="test-section">
            <h2>ğŸ’¾ å†…å­˜ä½¿ç”¨</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">å½“å‰å†…å­˜ä½¿ç”¨</div>
                    <div class="metric-value" id="currentMemory">-</div>
                    <span class="metric-unit">MB</span>
                    <div class="metric-status status-good" id="memoryStatus">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">JS å †å¤§å°</div>
                    <div class="metric-value" id="jsHeapSize">-</div>
                    <span class="metric-unit">MB</span>
                </div>
                <div class="metric-card">
                    <div class="metric-label">JS å †é™åˆ¶</div>
                    <div class="metric-value" id="jsHeapLimit">-</div>
                    <span class="metric-unit">MB</span>
                </div>
                <div class="metric-card">
                    <div class="metric-label">å †ä½¿ç”¨ç‡</div>
                    <div class="metric-value" id="heapUsage">-</div>
                    <span class="metric-unit">%</span>
                </div>
            </div>
            <button class="btn" onclick="updateMemoryMetrics()">ğŸ”„ åˆ·æ–°å†…å­˜æ•°æ®</button>
        </div>

        <!-- æ¸²æŸ“æ€§èƒ½æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ¨ æ¸²æŸ“æ€§èƒ½æµ‹è¯•</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">iframe åˆ›å»ºæ—¶é—´</div>
                    <div class="metric-value" id="iframeTime">-</div>
                    <span class="metric-unit">ms</span>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Canvas æ¸²æŸ“æ—¶é—´</div>
                    <div class="metric-value" id="canvasTime">-</div>
                    <span class="metric-unit">ms</span>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Worker åˆå§‹åŒ–æ—¶é—´</div>
                    <div class="metric-value" id="workerTime">-</div>
                    <span class="metric-unit">ms</span>
                </div>
                <div class="metric-card">
                    <div class="metric-label">DOM æ“ä½œæ€§èƒ½</div>
                    <div class="metric-value" id="domOpsTime">-</div>
                    <span class="metric-unit">ms</span>
                </div>
            </div>
            <button class="btn" onclick="runRenderingTests()">â–¶ï¸ è¿è¡Œæ¸²æŸ“æµ‹è¯•</button>
            <div class="progress-bar" id="renderProgress" style="display: none;">
                <div class="progress-fill" id="renderProgressFill"></div>
            </div>
        </div>

        <!-- æ€§èƒ½å¯¹æ¯” -->
        <div class="test-section">
            <h2>ğŸ“ˆ æ€§èƒ½å¯¹æ¯” (Tauri vs Electron)</h2>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>æŒ‡æ ‡</th>
                        <th>Tauri WebView2 (é¢„æœŸ)</th>
                        <th>Electron (å½“å‰)</th>
                        <th>æ”¹è¿›</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>å¯åŠ¨æ—¶é—´</td>
                        <td class="better">~500ms</td>
                        <td>~1500ms</td>
                        <td class="better">â†“ 67%</td>
                    </tr>
                    <tr>
                        <td>ç©ºé—²å†…å­˜</td>
                        <td class="better">~50MB</td>
                        <td>~150MB</td>
                        <td class="better">â†“ 67%</td>
                    </tr>
                    <tr>
                        <td>é˜…è¯»æ—¶å†…å­˜</td>
                        <td class="better">~80MB</td>
                        <td>~250MB</td>
                        <td class="better">â†“ 68%</td>
                    </tr>
                    <tr>
                        <td>æ‰“åŒ…ä½“ç§¯</td>
                        <td class="better">&lt; 20MB</td>
                        <td>~150MB</td>
                        <td class="better">â†“ 87%</td>
                    </tr>
                    <tr>
                        <td>EPUB æ¸²æŸ“</td>
                        <td class="better">~100ms</td>
                        <td>~150ms</td>
                        <td class="better">â†“ 33%</td>
                    </tr>
                    <tr>
                        <td>PDF æ¸²æŸ“</td>
                        <td class="better">~200ms</td>
                        <td>~300ms</td>
                        <td class="better">â†“ 33%</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="test-section">
            <h2>ğŸ¯ æµ‹è¯•æ“ä½œ</h2>
            <button class="btn" onclick="runAllTests()">â–¶ï¸ è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button class="btn btn-secondary" onclick="exportResults()">ğŸ“¥ å¯¼å‡ºç»“æœ</button>
            <button class="btn btn-secondary" onclick="clearLog()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <!-- æ—¥å¿—è¾“å‡º -->
        <div class="test-section">
            <h2>ğŸ“ æµ‹è¯•æ—¥å¿—</h2>
            <div class="log-container" id="logContainer"></div>
        </div>
    </div>

    <canvas id="testCanvas" width="800" height="600"></canvas>

    <script>
        // æ—¥å¿—ç³»ç»Ÿ
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.innerHTML = `<span class="log-time">[${time}]</span> ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function clearLog() {
            document.getElementById('logContainer').innerHTML = '';
            log('æ—¥å¿—å·²æ¸…ç©º', 'info');
        }

        // ç³»ç»Ÿä¿¡æ¯
        function collectSystemInfo() {
            log('æ”¶é›†ç³»ç»Ÿä¿¡æ¯...', 'info');
            
            document.getElementById('platform').textContent = navigator.platform;
            document.getElementById('userAgent').textContent = navigator.userAgent.substring(0, 50) + '...';
            document.getElementById('cpuCores').textContent = navigator.hardwareConcurrency || 'N/A';
            
            if (performance.memory) {
                const memLimit = (performance.memory.jsHeapSizeLimit / 1024 / 1024).toFixed(0);
                document.getElementById('memoryLimit').textContent = memLimit;
            }
            
            log('ç³»ç»Ÿä¿¡æ¯æ”¶é›†å®Œæˆ', 'info');
        }

        // å¯åŠ¨æ€§èƒ½
        function measureStartupPerformance() {
            log('æµ‹é‡å¯åŠ¨æ€§èƒ½...', 'info');
            
            const perfData = performance.timing;
            const loadTime = perfData.loadEventEnd - perfData.navigationStart;
            const domReady = perfData.domContentLoadedEventEnd - perfData.navigationStart;
            
            document.getElementById('loadTime').textContent = loadTime;
            document.getElementById('domReady').textContent = domReady;
            
            // è·å– Paint Timing
            const paintEntries = performance.getEntriesByType('paint');
            paintEntries.forEach(entry => {
                if (entry.name === 'first-paint') {
                    document.getElementById('firstPaint').textContent = Math.round(entry.startTime);
                } else if (entry.name === 'first-contentful-paint') {
                    document.getElementById('firstContentfulPaint').textContent = Math.round(entry.startTime);
                }
            });
            
            // çŠ¶æ€è¯„ä¼°
            const status = loadTime < 1000 ? 'excellent' : loadTime < 2000 ? 'good' : 'warning';
            const statusText = loadTime < 1000 ? 'ä¼˜ç§€' : loadTime < 2000 ? 'è‰¯å¥½' : 'éœ€ä¼˜åŒ–';
            document.getElementById('loadTimeStatus').textContent = statusText;
            document.getElementById('loadTimeStatus').className = `metric-status status-${status}`;
            
            log(`é¡µé¢åŠ è½½æ—¶é—´: ${loadTime}ms (${statusText})`, 'info');
        }

        // å†…å­˜ä½¿ç”¨
        function updateMemoryMetrics() {
            log('æ›´æ–°å†…å­˜æŒ‡æ ‡...', 'info');
            
            if (performance.memory) {
                const used = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1);
                const total = (performance.memory.totalJSHeapSize / 1024 / 1024).toFixed(1);
                const limit = (performance.memory.jsHeapSizeLimit / 1024 / 1024).toFixed(0);
                const usage = ((performance.memory.usedJSHeapSize / performance.memory.jsHeapSizeLimit) * 100).toFixed(1);
                
                document.getElementById('currentMemory').textContent = used;
                document.getElementById('jsHeapSize').textContent = total;
                document.getElementById('jsHeapLimit').textContent = limit;
                document.getElementById('heapUsage').textContent = usage;
                
                // çŠ¶æ€è¯„ä¼°
                const status = usage < 50 ? 'excellent' : usage < 75 ? 'good' : 'warning';
                const statusText = usage < 50 ? 'ä¼˜ç§€' : usage < 75 ? 'è‰¯å¥½' : 'éœ€æ³¨æ„';
                document.getElementById('memoryStatus').textContent = statusText;
                document.getElementById('memoryStatus').className = `metric-status status-${status}`;
                
                log(`å†…å­˜ä½¿ç”¨: ${used}MB / ${limit}MB (${usage}%)`, 'info');
            } else {
                log('æµè§ˆå™¨ä¸æ”¯æŒ performance.memory API', 'warning');
            }
        }

        // æ¸²æŸ“æ€§èƒ½æµ‹è¯•
        async function runRenderingTests() {
            log('å¼€å§‹æ¸²æŸ“æ€§èƒ½æµ‹è¯•...', 'info');
            
            const progress = document.getElementById('renderProgress');
            const progressFill = document.getElementById('renderProgressFill');
            progress.style.display = 'block';
            
            // Test 1: iframe åˆ›å»º
            progressFill.style.width = '25%';
            const iframeStart = performance.now();
            const iframe = document.createElement('iframe');
            iframe.srcdoc = '<html><body><h1>Test Content</h1></body></html>';
            document.body.appendChild(iframe);
            await new Promise(resolve => setTimeout(resolve, 100));
            const iframeTime = (performance.now() - iframeStart).toFixed(2);
            document.getElementById('iframeTime').textContent = iframeTime;
            document.body.removeChild(iframe);
            log(`iframe åˆ›å»ºæ—¶é—´: ${iframeTime}ms`, 'info');
            
            // Test 2: Canvas æ¸²æŸ“
            progressFill.style.width = '50%';
            const canvas = document.getElementById('testCanvas');
            const ctx = canvas.getContext('2d');
            const canvasStart = performance.now();
            for (let i = 0; i < 1000; i++) {
                ctx.fillStyle = `rgb(${i % 255}, ${(i * 2) % 255}, ${(i * 3) % 255})`;
                ctx.fillRect(Math.random() * 800, Math.random() * 600, 10, 10);
            }
            const canvasTime = (performance.now() - canvasStart).toFixed(2);
            document.getElementById('canvasTime').textContent = canvasTime;
            log(`Canvas æ¸²æŸ“æ—¶é—´: ${canvasTime}ms`, 'info');
            
            // Test 3: Worker åˆå§‹åŒ–
            progressFill.style.width = '75%';
            const workerStart = performance.now();
            const workerCode = `
                self.onmessage = function(e) {
                    self.postMessage('pong');
                };
            `;
            const blob = new Blob([workerCode], { type: 'application/javascript' });
            const worker = new Worker(URL.createObjectURL(blob));
            await new Promise(resolve => {
                worker.onmessage = () => {
                    const workerTime = (performance.now() - workerStart).toFixed(2);
                    document.getElementById('workerTime').textContent = workerTime;
                    log(`Worker åˆå§‹åŒ–æ—¶é—´: ${workerTime}ms`, 'info');
                    worker.terminate();
                    resolve();
                };
                worker.postMessage('ping');
            });
            
            // Test 4: DOM æ“ä½œ
            progressFill.style.width = '100%';
            const domStart = performance.now();
            const container = document.createElement('div');
            for (let i = 0; i < 1000; i++) {
                const div = document.createElement('div');
                div.textContent = `Item ${i}`;
                container.appendChild(div);
            }
            document.body.appendChild(container);
            await new Promise(resolve => setTimeout(resolve, 10));
            document.body.removeChild(container);
            const domTime = (performance.now() - domStart).toFixed(2);
            document.getElementById('domOpsTime').textContent = domTime;
            log(`DOM æ“ä½œæ—¶é—´: ${domTime}ms`, 'info');
            
            setTimeout(() => {
                progress.style.display = 'none';
                progressFill.style.width = '0%';
            }, 1000);
            
            log('æ¸²æŸ“æ€§èƒ½æµ‹è¯•å®Œæˆ', 'info');
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            log('========================================', 'info');
            log('å¼€å§‹å®Œæ•´æ€§èƒ½åŸºå‡†æµ‹è¯•', 'info');
            log('========================================', 'info');
            
            collectSystemInfo();
            measureStartupPerformance();
            updateMemoryMetrics();
            await runRenderingTests();
            
            log('========================================', 'info');
            log('æ‰€æœ‰æµ‹è¯•å®Œæˆï¼', 'info');
            log('========================================', 'info');
        }

        // å¯¼å‡ºç»“æœ
        function exportResults() {
            const results = {
                timestamp: new Date().toISOString(),
                platform: navigator.platform,
                userAgent: navigator.userAgent,
                metrics: {
                    startup: {
                        loadTime: document.getElementById('loadTime').textContent,
                        domReady: document.getElementById('domReady').textContent,
                        firstPaint: document.getElementById('firstPaint').textContent,
                        firstContentfulPaint: document.getElementById('firstContentfulPaint').textContent
                    },
                    memory: {
                        current: document.getElementById('currentMemory').textContent,
                        jsHeapSize: document.getElementById('jsHeapSize').textContent,
                        jsHeapLimit: document.getElementById('jsHeapLimit').textContent,
                        heapUsage: document.getElementById('heapUsage').textContent
                    },
                    rendering: {
                        iframeTime: document.getElementById('iframeTime').textContent,
                        canvasTime: document.getElementById('canvasTime').textContent,
                        workerTime: document.getElementById('workerTime').textContent,
                        domOpsTime: document.getElementById('domOpsTime').textContent
                    }
                }
            };
            
            const json = JSON.stringify(results, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `performance-benchmark-${Date.now()}.json`;
            a.click();
            
            log('æµ‹è¯•ç»“æœå·²å¯¼å‡º', 'info');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œ
        window.addEventListener('load', () => {
            setTimeout(() => {
                collectSystemInfo();
                measureStartupPerformance();
                updateMemoryMetrics();
            }, 100);
        });
    </script>
</body>
</html>
