import{s as ie,u as ue,o as ve,Q as n,F as P,w as de,l as c,z as l,T as U,P as Y,D as ge,y as ye,a as T,L as z,b as F,r as i,K as b,W as f,n as S,M as me,R as pe,N as u,c as ke,d as X}from"./index-BXAhAS9o.js";import{r as be}from"./dayjs.min-Dib4ouKk-Bg5S4in8.js";import{j as fe}from"./ebook-Bqqd_rdk-ozmTfELU.js";const he={class:"home"},we={class:"header"},Ce={class:"header-actions"},De={class:"search-box"},Ee={class:"main"},xe={class:"category-filter"},Te={class:"category-tabs"},Se=["onClick"],Be={class:"category-count"},$e={class:"books-section"},Le={class:"section-header"},Pe={class:"section-title"},Ie={class:"view-controls"},_e={key:0,class:"search-loading"},Re={key:1,class:"search-results-info"},Me=["onClick","onContextmenu"],Ue={class:"book-format"},Ye={class:"book-storage"},ze={class:"book-info"},Fe={class:"book-title"},Ke={class:"book-author"},Ne={class:"book-progress"},Ve={class:"progress"},We={class:"progress-text"},je={class:"book-last-read"},Qe={key:0,class:"book-category"},Xe={key:2,class:"empty-state"},qe={key:3,class:"empty-state"},Ae=["onClick"],He={class:"dialog-form"},Ge={class:"form-group"},Je={class:"form-group"},Oe={class:"dialog-buttons"},Ze=["disabled"],el=ue({__name:"index",setup(ll){const q=me(),r=fe(),s=ve(),h=n("grid"),w=n(null),y=n(""),g=n("all"),B=n(!1),$=n(!1),C=n(0),L=n(0),D=n(0),I=n(0),m=n(null),_=n(!1),p=n(""),E=n("#4A90E2"),k=n([]),x=n(!1),K=P(()=>r.books),N=P(()=>r.categories||[]),A=P(()=>g.value==="all"?K.value:K.value.filter(a=>a.categoryId===g.value)),V=P(()=>y.value&&k.value.length>0?k.value:A.value),H=a=>{q.push(`/reader/${a}`)},G=()=>{w.value&&w.value.click()},J=async a=>{var e;const t=(e=a.target.files)==null?void 0:e[0];if(!t)return;const o=t.name.toLowerCase().split(".").pop();if(!["epub","pdf","txt"].includes(o||"")){s.showErrorDialog("ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼","ä»…æ”¯æŒ EPUBã€PDF å’Œ TXT æ ¼å¼çš„ç”µå­ä¹¦");return}try{s.showDialog({title:"æ­£åœ¨å¯¼å…¥",message:`æ­£åœ¨å¯¼å…¥ ${t.name} ...`,type:"info",buttons:[]}),await r.importEbookFile(t)?(s.closeDialog(),s.showSuccessDialog("å¯¼å…¥æˆåŠŸ")):(s.closeDialog(),s.showErrorDialog("å¯¼å…¥å¤±è´¥","æ— æ³•å¯¼å…¥æ‰€é€‰æ–‡ä»¶"))}catch(v){s.closeDialog(),console.error("å¯¼å…¥æ–‡ä»¶å¤±è´¥:",v),s.showErrorDialog("å¯¼å…¥å¤±è´¥",v instanceof Error?v.message:String(v))}finally{w.value&&(w.value.value="")}},O=a=>be(a).format("YYYY-MM-DD HH:mm"),Z=(a,e)=>{a.preventDefault(),B.value=!0,$.value=!1,C.value=a.clientX,L.value=a.clientY,m.value=e,document.addEventListener("click",d)},d=()=>{B.value=!1,$.value=!1,m.value=null,document.removeEventListener("click",d)},ee=async()=>{if(!m.value)return;const a=m.value;d(),await ae(a)},le=()=>{if(!m.value)return;const a=m.value;d(),oe(a)},ae=async a=>{if(a)try{await r.uploadLocalBookToBaidupan(a),s.showSuccessDialog("ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜æˆåŠŸ")}catch(e){console.error("ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜å¤±è´¥:",e),s.showErrorDialog("ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜å¤±è´¥",e instanceof Error?e.message:String(e))}finally{d()}},oe=async a=>{if(!a)return;const e=a.id,t=a.title,o=a.storageType;s.showDialog({title:"ç¡®è®¤åˆ é™¤",message:`ç¡®å®šè¦åˆ é™¤ã€Š${t}ã€‹å—ï¼Ÿ`,type:"warning",buttons:[{text:"å–æ¶ˆ"},{text:"åˆ é™¤",primary:!0,callback:async()=>{console.log("å¼€å§‹æ‰§è¡Œåˆ é™¤é€»è¾‘, ID:",e);try{await r.removeBook(e,o)?s.showSuccessDialog("ä¹¦ç±åˆ é™¤æˆåŠŸ"):s.showErrorDialog("åˆ é™¤å¤±è´¥","æ— æ³•åˆ é™¤æŒ‡å®šä¹¦ç±")}catch(v){console.error("åˆ é™¤è¿‡ç¨‹æŠ¥é”™:",v),s.showErrorDialog("åˆ é™¤å¤±è´¥",v instanceof Error?v.message:String(v))}}}]}),d()},se=()=>{console.log("æ‰“å¼€åˆ†ç±»ç®¡ç†èœå•"),console.log("ä¸»èœå•ä½ç½®:",C.value,L.value),D.value=C.value+180,I.value=L.value,D.value+180>window.innerWidth&&(D.value=C.value-180),console.log("å­èœå•ä½ç½®:",D.value,I.value),B.value=!1,document.removeEventListener("click",d),setTimeout(()=>{$.value=!0,console.log("å­èœå•å·²æ˜¾ç¤º"),setTimeout(()=>{document.addEventListener("click",te)},100)},50)},te=a=>{const e=document.querySelector(".category-submenu");e&&!e.contains(a.target)&&d()},ne=async a=>{if(!m.value){console.error("selectedBook ä¸º nullï¼Œæ— æ³•ç§»åŠ¨ä¹¦ç±");return}const e=m.value;console.log("ç§»åŠ¨ä¹¦ç±åˆ°åˆ†ç±»:",e.title,"->",a),console.log("selectedBook:",m.value);try{console.log("è°ƒç”¨ ebookStore.addBookToCategory");const t=await r.addBookToCategory(e.id,a);console.log("addBookToCategory è¿”å›ç»“æœ:",t),t?(s.showSuccessDialog("ä¹¦ç±åˆ†ç±»æ›´æ–°æˆåŠŸ"),d(),console.log("ä¹¦ç±åˆ†ç±»æ›´æ–°æˆåŠŸï¼Œèœå•å·²å…³é—­")):(s.showErrorDialog("åˆ†ç±»æ›´æ–°å¤±è´¥","æ— æ³•æ‰¾åˆ°æŒ‡å®šä¹¦ç±æˆ–åˆ†ç±»"),d(),console.log("ä¹¦ç±åˆ†ç±»æ›´æ–°å¤±è´¥ï¼Œèœå•å·²å…³é—­"))}catch(t){console.error("ç§»åŠ¨ä¹¦ç±åˆ°åˆ†ç±»å¤±è´¥:",t),s.showErrorDialog("åˆ†ç±»æ›´æ–°å¤±è´¥",t instanceof Error?t.message:String(t)),d()}},W=()=>{_.value=!0,p.value="",E.value="#4A90E2",d()},R=()=>{_.value=!1,p.value=""},re=async()=>{if(p.value.trim()){console.log("å¼€å§‹åˆ›å»ºåˆ†ç±»ï¼Œåç§°:",p.value.trim(),"é¢œè‰²:",E.value);try{const a=await r.addCategory(p.value.trim(),E.value);console.log("åˆ†ç±»åˆ›å»ºæˆåŠŸï¼Œè¿”å›ç»“æœ:",a),await new Promise(e=>setTimeout(e,100)),console.log("å½“å‰åˆ†ç±»åˆ—è¡¨:",r.categories),console.log("åˆ†ç±»æ•°é‡:",r.categories.length),s.showSuccessDialog("åˆ†ç±»åˆ›å»ºæˆåŠŸ"),R()}catch(a){console.error("æ·»åŠ åˆ†ç±»å¤±è´¥:",a),s.showErrorDialog("åˆ†ç±»åˆ›å»ºå¤±è´¥",a instanceof Error?a.message:String(a))}}},j=async()=>{if(!y.value.trim()){M();return}x.value=!0;try{const a=await r.searchBooks(y.value.trim());k.value=a}catch(a){console.error("æœç´¢å¤±è´¥:",a),s.showErrorDialog("æœç´¢å¤±è´¥",a instanceof Error?a.message:String(a)),k.value=[]}finally{x.value=!1}},M=()=>{y.value="",k.value=[]},Q=a=>{const e=r.categories.find(t=>t.id===a);return e?e.name:"æœªåˆ†ç±»"},ce=a=>r.books.filter(e=>e.categoryId===a);return de(async()=>{try{console.log("é¦–é¡µåŠ è½½ï¼Œå¼€å§‹åˆå§‹åŒ–ç”µå­ä¹¦å­˜å‚¨..."),await r.initialize(),console.log("ç”µå­ä¹¦å­˜å‚¨åˆå§‹åŒ–å®Œæˆ"),console.log("å½“å‰ä¹¦ç±æ•°é‡:",r.books.length),console.log("å½“å‰åˆ†ç±»æ•°é‡:",r.categories.length)}catch(a){console.error("åˆå§‹åŒ–ç”µå­ä¹¦å­˜å‚¨å¤±è´¥:",a)}}),(a,e)=>{const t=pe("router-link");return u(),c("div",he,[l("header",we,[e[11]||(e[11]=l("h1",{class:"title"},"Neat Reader",-1)),l("div",Ce,[l("div",De,[U(l("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>y.value=o),placeholder:"æœç´¢ä¹¦åã€ä½œè€…",class:"search-input",onKeyup:ge(j,["enter"])},null,544),[[Y,y.value]]),l("button",{class:"search-btn",onClick:j}," ğŸ” ")]),ye(t,{to:"/settings",class:"btn btn-secondary"},{default:ke(()=>[...e[10]||(e[10]=[X(" è®¾ç½® ",-1)])]),_:1})])]),l("main",Ee,[l("div",xe,[l("div",Te,[l("button",{class:T(["category-tab",{active:g.value==="all"}]),onClick:e[1]||(e[1]=o=>g.value="all")}," å…¨éƒ¨ ",2),(u(!0),c(z,null,F(N.value,o=>(u(),c("button",{key:o.id,class:T(["category-tab",{active:g.value===o.id}]),style:S({borderColor:o.color}),onClick:v=>g.value=o.id},[X(i(o.name)+" ",1),l("span",Be,"("+i(ce(o.id).length)+")",1)],14,Se))),128)),l("button",{class:"category-tab add-category",onClick:W}," + æ–°å»ºåˆ†ç±» ")])]),l("div",$e,[l("div",Le,[l("h2",Pe,i(g.value==="all"?"æˆ‘çš„ä¹¦æ¶":Q(g.value)),1),l("div",Ie,[l("button",{class:T(["btn btn-secondary",{active:h.value==="grid"}]),onClick:e[2]||(e[2]=o=>h.value="grid")}," ç½‘æ ¼ ",2),l("button",{class:T(["btn btn-secondary",{active:h.value==="list"}]),onClick:e[3]||(e[3]=o=>h.value="list")}," åˆ—è¡¨ ",2)])]),x.value?(u(),c("div",_e,[...e[12]||(e[12]=[l("div",{class:"loading-spinner"},null,-1),l("p",null,"æ­£åœ¨æœç´¢...",-1)])])):k.value.length>0&&y.value?(u(),c("div",Re,[l("p",null,"æ‰¾åˆ° "+i(k.value.length)+" ä¸ªç»“æœï¼Œå…³é”®è¯: "+i(y.value),1),l("button",{class:"btn btn-sm",onClick:M},"æ¸…é™¤æœç´¢")])):b("",!0),l("div",{class:T([h.value==="grid"?"grid":"list","books-list"])},[(u(!0),c(z,null,F(V.value,o=>(u(),c("div",{key:o.id,class:"book-item",onClick:v=>H(o.id),onContextmenu:f(v=>Z(v,o),["prevent"])},[l("div",{class:"book-cover",style:S({backgroundImage:`url(${o.cover})`})},[l("div",Ue,i(o.format.toUpperCase()),1),l("div",Ye,i(o.storageType==="local"?"ğŸ’»":"â˜ï¸"),1)],4),l("div",ze,[l("h3",Fe,i(o.title),1),l("p",Ke,i(o.author),1),l("div",Ne,[l("div",Ve,[l("div",{class:"progress-bar",style:S({width:`${o.readingProgress}%`})},null,4)]),l("span",We,i(o.readingProgress)+"%",1)]),l("p",je,i(O(o.lastRead)),1),o.categoryId?(u(),c("div",Qe,i(Q(o.categoryId)),1)):b("",!0)])],40,Me))),128))],2),V.value.length===0&&!x.value?(u(),c("div",Xe,[e[13]||(e[13]=l("div",{class:"empty-icon"},"ğŸ“š",-1)),l("h3",null,i(g.value==="all"?"ä¹¦æ¶æ˜¯ç©ºçš„":"è¯¥åˆ†ç±»ä¸‹æ²¡æœ‰ä¹¦ç±"),1),l("p",null,i(g.value==="all"?"æ·»åŠ ä¸€äº›ç”µå­ä¹¦å¼€å§‹é˜…è¯»å§":"ç‚¹å‡»å³ä¸Šè§’æ·»åŠ ä¹¦ç±"),1)])):b("",!0),k.value.length===0&&y.value&&!x.value?(u(),c("div",qe,[e[14]||(e[14]=l("div",{class:"empty-icon"},"ğŸ”",-1)),e[15]||(e[15]=l("h3",null,"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ä¹¦ç±",-1)),e[16]||(e[16]=l("p",null,"å°è¯•å…¶ä»–å…³é”®è¯æˆ–æ£€æŸ¥æ‹¼å†™",-1)),l("button",{class:"btn btn-secondary",onClick:M},"æ¸…é™¤æœç´¢")])):b("",!0)])]),l("button",{class:"add-btn",onClick:G}," + "),l("input",{type:"file",ref_key:"fileInputRef",ref:w,onChange:J,style:{display:"none"},accept:".epub,.pdf,.txt"},null,544),B.value?(u(),c("div",{key:0,class:"context-menu",style:S({left:C.value+"px",top:L.value+"px"}),onContextmenu:e[4]||(e[4]=f(()=>{},["prevent"]))},[l("div",{class:"menu-item",onClick:ee}," ğŸ“¤ ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜ "),l("div",{class:"menu-item",onClick:se}," ğŸ“ åˆ†ç±»ç®¡ç† "),l("div",{class:"menu-item",onClick:le}," ğŸ—‘ï¸ åˆ é™¤ä¹¦ç± ")],36)):b("",!0),$.value?(u(),c("div",{key:1,class:"context-menu category-submenu",style:S({left:D.value+"px",top:I.value+"px"}),onClick:e[5]||(e[5]=f(()=>{},["stop"])),onContextmenu:e[6]||(e[6]=f(()=>{},["prevent"]))},[(u(!0),c(z,null,F(N.value,o=>(u(),c("div",{key:o.id,class:"menu-item",onClick:v=>ne(o.id)},i(o.name),9,Ae))),128)),l("div",{class:"menu-item add-category",onClick:f(W,["stop"])}," + æ–°å»ºåˆ†ç±» ")],36)):b("",!0),_.value?(u(),c("div",{key:2,class:"dialog-overlay",onClick:R},[l("div",{class:"dialog-content",onClick:e[9]||(e[9]=f(()=>{},["stop"]))},[e[19]||(e[19]=l("h3",null,"æ–°å»ºåˆ†ç±»",-1)),l("div",He,[l("div",Ge,[e[17]||(e[17]=l("label",null,"åˆ†ç±»åç§°",-1)),U(l("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=o=>p.value=o),placeholder:"è¾“å…¥åˆ†ç±»åç§°",class:"form-input"},null,512),[[Y,p.value]])]),l("div",Je,[e[18]||(e[18]=l("label",null,"åˆ†ç±»é¢œè‰²",-1)),U(l("input",{type:"color","onUpdate:modelValue":e[8]||(e[8]=o=>E.value=o),class:"color-picker"},null,512),[[Y,E.value]])])]),l("div",Oe,[l("button",{class:"btn btn-secondary",onClick:R},"å–æ¶ˆ"),l("button",{class:"btn btn-primary",onClick:re,disabled:!p.value.trim()},"åˆ›å»º",8,Ze)])])])):b("",!0)])}}}),tl=ie(el,[["__scopeId","data-v-7b2cec52"]]);export{tl as default};
