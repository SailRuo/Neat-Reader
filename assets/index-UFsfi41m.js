import{d as I,u as j,o as A,c as d,a as s,e as N,f as P,t as b,w as k,v as C,n as r,k as S,j as h,l as B,q as u,m as R,_ as L}from"./index-DmZ-yhyG.js";import{u as O}from"./ebook-DPib_uvh.js";const q={class:"settings"},J={class:"header"},K={class:"main"},G={class:"settings-container"},H={class:"setting-section"},Q={class:"setting-card"},W={class:"setting-row"},X={class:"setting-info"},Y={key:0,class:"setting-desc"},Z={key:1,class:"setting-desc"},ss={class:"setting-control"},ts={class:"baidupan-status"},es={key:0,class:"status connected"},as={key:1,class:"status disconnected"},ns={key:0,class:"setting-row"},os={class:"setting-info",style:{width:"100%"}},is=["disabled"],ls={key:1,class:"setting-row"},cs={class:"setting-info",style:{width:"100%"}},ds={class:"user-info"},rs=["src"],us={class:"user-detail"},vs={class:"user-name"},ps={class:"user-vip"},gs={class:"setting-section"},_s={class:"setting-card"},fs={class:"setting-row"},bs={class:"setting-info"},hs={class:"setting-desc"},ms={class:"setting-control"},ys={class:"stepper"},ws={class:"stepper-value"},ks={class:"setting-row"},Cs={class:"setting-control"},Ss=["model-value"],xs={class:"setting-row"},Us={class:"setting-control"},zs={class:"theme-selector"},Ds={class:"setting-row"},Ts={class:"setting-control"},Ms={class:"toggle-group"},$s={class:"setting-section"},Es={class:"setting-card"},Vs={class:"setting-row"},Fs={class:"setting-control"},Is={class:"toggle-group"},js={class:"setting-row"},As={class:"setting-control"},Ns=["model-value"],Ps=I({__name:"index",setup(Bs){const n=O(),v=j(),p=S(()=>n.userConfig.storage),a=S(()=>n.userConfig.reader),m=S(()=>n.userConfig.ui),g=h(""),_=h(""),c=h(""),y=h(""),f=h(!1),i=h(null),z=e=>{var l;const t=(l=e.clipboardData)==null?void 0:l.getData("text");t&&(c.value=t,e.preventDefault())},D=async()=>{if(!(!g.value||!_.value||!c.value)){f.value=!0;try{const t=await(await fetch("http://localhost:3001/api/baidu/oauth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:g.value,client_secret:_.value,refresh_token:c.value})})).json();t.success?(y.value=t.access_token,T()):v.showErrorDialog("获取失败",t.message)}catch{v.showErrorDialog("获取失败","网络错误，请重试")}finally{f.value=!1}}},T=async()=>{if(y.value){f.value=!0;try{const t=await(await fetch(`http://localhost:3001/api/baidu/pan/verify?token=${encodeURIComponent(y.value)}`)).json();t.valid?(i.value={baidu_name:t.user.baidu_name,avatar_url:t.user.avatar_url,vip_type:t.user.vip_type},await n.updateUserConfig({storage:{...p.value,baidupan:{...p.value.baidupan,accessToken:y.value,userId:String(t.user.uk),expiration:Date.now()+720*60*60*1e3}}}),v.showSuccessDialog("百度网盘授权成功")):v.showErrorDialog("验证失败",t.message||"无效的token")}catch{v.showErrorDialog("验证失败","网络错误，请重试")}finally{f.value=!1}}},M=async()=>{await n.updateUserConfig({storage:{...p.value,baidupan:{...p.value.baidupan,accessToken:"",userId:""}}}),i.value=null,c.value="",g.value="",_.value="",v.showSuccessDialog("已取消授权")},$=async()=>{a.value.fontSize>12&&await n.updateUserConfig({reader:{...a.value,fontSize:a.value.fontSize-1}})},E=async()=>{a.value.fontSize<32&&await n.updateUserConfig({reader:{...a.value,fontSize:a.value.fontSize+1}})},V=async e=>{const t=e.target;await n.updateUserConfig({reader:{...a.value,fontFamily:t.value}})},w=async e=>{await n.updateUserConfig({reader:{...a.value,theme:e}})},x=async e=>{await n.updateUserConfig({reader:{...a.value,pageMode:e}})},U=async e=>{await n.updateUserConfig({ui:{...m.value,viewMode:e}})},F=async e=>{const t=e.target;await n.updateUserConfig({ui:{...m.value,language:t.value}})};return A(async()=>{var e;if(await n.initialize(),(e=p.value.baidupan)!=null&&e.accessToken)try{const l=await(await fetch(`http://localhost:3001/api/baidu/pan/verify?token=${encodeURIComponent(p.value.baidupan.accessToken)}`)).json();l.valid&&(i.value={baidu_name:l.user.baidu_name,avatar_url:l.user.avatar_url,vip_type:l.user.vip_type})}catch{console.warn("验证已保存的token失败")}}),(e,t)=>{const l=B("router-link");return u(),d("div",q,[s("header",J,[t[11]||(t[11]=s("h1",{class:"title"},"设置",-1)),N(l,{to:"/",class:"btn btn-secondary"},{default:P(()=>[...t[10]||(t[10]=[R("← 返回",-1)])]),_:1})]),s("main",K,[s("div",G,[s("section",H,[t[13]||(t[13]=s("h2",{class:"section-title"},"百度网盘",-1)),s("div",Q,[s("div",W,[s("div",X,[t[12]||(t[12]=s("span",{class:"setting-label"},"授权状态",-1)),i.value?(u(),d("span",Y,"已连接："+b(i.value.baidu_name),1)):(u(),d("span",Z,"配置百度网盘信息以获取access_token"))]),s("div",ss,[s("div",ts,[i.value?(u(),d("span",es,"已授权")):(u(),d("span",as,"未授权"))])])]),i.value?(u(),d("div",ls,[s("div",cs,[s("div",ds,[s("img",{src:i.value.avatar_url,class:"user-avatar",alt:"头像"},null,8,rs),s("div",us,[s("span",vs,b(i.value.baidu_name),1),s("span",ps,b(i.value.vip_type===2?"超级会员":i.value.vip_type===1?"普通会员":"普通用户"),1)])]),s("button",{class:"btn btn-danger",style:{width:"100%","margin-top":"12px"},onClick:M}," 取消授权 ")])])):(u(),d("div",ns,[s("div",os,[k(s("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=o=>g.value=o),placeholder:"百度网盘 App Key",style:{width:"100%","margin-bottom":"12px"}},null,512),[[C,g.value]]),k(s("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=o=>_.value=o),placeholder:"百度网盘 App Secret",style:{width:"100%","margin-bottom":"12px"}},null,512),[[C,_.value]]),k(s("input",{type:"text",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=o=>c.value=o),placeholder:"Refresh Token",style:{width:"100%","margin-bottom":"12px"},onPaste:z},null,544),[[C,c.value]]),s("button",{class:"btn btn-primary",style:{width:"100%"},onClick:D,disabled:!g.value||!_.value||!c.value||f.value},b(f.value?"获取中...":"获取access_token"),9,is)])]))])]),s("section",gs,[t[19]||(t[19]=s("h2",{class:"section-title"},"阅读",-1)),s("div",_s,[s("div",fs,[s("div",bs,[t[14]||(t[14]=s("span",{class:"setting-label"},"字体大小",-1)),s("span",hs,"调整阅读时的字体大小 ("+b(a.value.fontSize)+"px)",1)]),s("div",ms,[s("div",ys,[s("button",{class:"btn btn-secondary btn-sm",onClick:$},"-"),s("span",ws,b(a.value.fontSize),1),s("button",{class:"btn btn-secondary btn-sm",onClick:E},"+")])])]),s("div",ks,[t[16]||(t[16]=s("div",{class:"setting-info"},[s("span",{class:"setting-label"},"字体"),s("span",{class:"setting-desc"},"选择阅读时的字体")],-1)),s("div",Cs,[s("select",{class:"form-control","model-value":a.value.fontFamily,onChange:V},[...t[15]||(t[15]=[s("option",{value:"system"},"系统默认",-1),s("option",{value:"sans-serif"},"无衬线体",-1),s("option",{value:"serif"},"衬线体",-1),s("option",{value:"monospace"},"等宽字体",-1)])],40,Ss)])]),s("div",xs,[t[17]||(t[17]=s("div",{class:"setting-info"},[s("span",{class:"setting-label"},"主题"),s("span",{class:"setting-desc"},"选择阅读界面的主题")],-1)),s("div",Us,[s("div",zs,[s("button",{class:r(["theme-btn light",{active:a.value.theme==="light"}]),onClick:t[3]||(t[3]=o=>w("light")),title:"浅色"},null,2),s("button",{class:r(["theme-btn sepia",{active:a.value.theme==="sepia"}]),onClick:t[4]||(t[4]=o=>w("sepia")),title:"护眼"},null,2),s("button",{class:r(["theme-btn dark",{active:a.value.theme==="dark"}]),onClick:t[5]||(t[5]=o=>w("dark")),title:"深色"},null,2)])])]),s("div",Ds,[t[18]||(t[18]=s("div",{class:"setting-info"},[s("span",{class:"setting-label"},"翻页模式"),s("span",{class:"setting-desc"},"选择翻页方式")],-1)),s("div",Ts,[s("div",Ms,[s("button",{class:r(["toggle-btn",{active:a.value.pageMode==="page"}]),onClick:t[6]||(t[6]=o=>x("page"))},"单页",2),s("button",{class:r(["toggle-btn",{active:a.value.pageMode==="scroll"}]),onClick:t[7]||(t[7]=o=>x("scroll"))},"滚动",2)])])])])]),s("section",$s,[t[23]||(t[23]=s("h2",{class:"section-title"},"外观",-1)),s("div",Es,[s("div",Vs,[t[20]||(t[20]=s("div",{class:"setting-info"},[s("span",{class:"setting-label"},"视图模式"),s("span",{class:"setting-desc"},"书架的显示方式")],-1)),s("div",Fs,[s("div",Is,[s("button",{class:r(["toggle-btn",{active:m.value.viewMode==="grid"}]),onClick:t[8]||(t[8]=o=>U("grid"))},"网格",2),s("button",{class:r(["toggle-btn",{active:m.value.viewMode==="list"}]),onClick:t[9]||(t[9]=o=>U("list"))},"列表",2)])])]),s("div",js,[t[22]||(t[22]=s("div",{class:"setting-info"},[s("span",{class:"setting-label"},"语言"),s("span",{class:"setting-desc"},"界面语言")],-1)),s("div",As,[s("select",{class:"form-control","model-value":m.value.language,onChange:F},[...t[21]||(t[21]=[s("option",{value:"zh-CN"},"简体中文",-1),s("option",{value:"en-US"},"English",-1)])],40,Ns)])])])])])])])}}}),Os=L(Ps,[["__scopeId","data-v-e89c7ff6"]]);export{Os as default};
