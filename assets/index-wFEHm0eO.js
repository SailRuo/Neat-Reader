import{d as ue,u as de,o as ve,c as i,a as o,w as Y,v as F,b as ge,e as me,f as pe,n as S,F as U,r as A,t as c,g as h,h as k,i as B,j as n,k as I,l as ye,m as H,p as fe,q as u,_ as he}from"./index-DmZ-yhyG.js";import{d as ke}from"./dayjs.min-Bkmd2vWS.js";import{u as be}from"./ebook-DPib_uvh.js";const Ce={class:"home"},we={class:"header"},_e={class:"header-actions"},De={class:"search-box"},xe={class:"main"},Ee={class:"category-filter"},Se={class:"category-tabs"},Be=["onClick"],Te={class:"category-count"},Me={class:"books-section"},$e={class:"section-header"},Ie={class:"section-title"},Re={class:"view-controls"},Ve={key:0,class:"search-loading"},Le={key:1,class:"search-results-info"},Ne=["onClick","onContextmenu"],Ye={class:"book-format"},Fe={class:"book-storage"},Ue={class:"book-info"},Ae={class:"book-title"},Pe={class:"book-author"},Xe={class:"book-progress"},ze={class:"progress"},Ke={class:"progress-text"},je={class:"book-last-read"},qe={key:0,class:"book-category"},He={key:2,class:"empty-state"},We={key:3,class:"empty-state"},Ge=["onClick"],Je={class:"dialog-form"},Oe={class:"form-group"},Qe={class:"form-group"},Ze={class:"dialog-buttons"},eo=["disabled"],oo=ue({__name:"index",setup(to){const W=fe(),r=be(),l=de(),b=n("grid"),C=n(null),m=n(""),g=n("all"),T=n(!1),M=n(!1),w=n(0),$=n(0),_=n(0),R=n(0),p=n(null),V=n(!1),y=n(""),D=n("#4A90E2"),f=n([]),x=n(!1),P=I(()=>r.books),X=I(()=>r.categories||[]),G=I(()=>g.value==="all"?P.value:P.value.filter(t=>t.categoryId===g.value)),z=I(()=>m.value&&f.value.length>0?f.value:G.value),J=t=>{W.push(`/reader/${t}`)},O=()=>{C.value&&C.value.click()},Q=async t=>{var d;const a=(d=t.target.files)==null?void 0:d[0];if(!a)return;const s=a.name.toLowerCase().split(".").pop();if(!["epub","pdf","txt"].includes(s||"")){l.showErrorDialog("ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼","ä»…æ”¯æŒ EPUBã€PDF å’Œ TXT æ ¼å¼çš„ç”µå­ä¹¦");return}try{l.showDialog({title:"æ­£åœ¨å¯¼å…¥",message:`æ­£åœ¨å¯¼å…¥ ${a.name} ...`,type:"info",buttons:[]}),await r.importEbookFile(a)?(l.closeDialog(),l.showSuccessDialog("å¯¼å…¥æˆåŠŸ")):(l.closeDialog(),l.showErrorDialog("å¯¼å…¥å¤±è´¥","æ— æ³•å¯¼å…¥æ‰€é€‰æ–‡ä»¶"))}catch(E){l.closeDialog(),console.error("å¯¼å…¥æ–‡ä»¶å¤±è´¥:",E),l.showErrorDialog("å¯¼å…¥å¤±è´¥",E instanceof Error?E.message:String(E))}finally{C.value&&(C.value.value="")}},Z=t=>ke(t).format("YYYY-MM-DD HH:mm"),ee=(t,e)=>{t.preventDefault(),T.value=!0,M.value=!1,w.value=t.clientX,$.value=t.clientY,p.value=e,document.addEventListener("click",v)},v=()=>{T.value=!1,M.value=!1,p.value=null,document.removeEventListener("click",v)},oe=async()=>{if(!p.value)return;const t=p.value;v(),await se(t)},te=()=>{if(!p.value)return;const t=p.value;v(),le(t)},se=async t=>{if(t)try{await r.uploadLocalBookToBaidupan(t),l.showSuccessDialog("ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜æˆåŠŸ")}catch(e){console.error("ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜å¤±è´¥:",e),l.showErrorDialog("ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜å¤±è´¥",e instanceof Error?e.message:String(e))}finally{v()}},le=async t=>{if(!t)return;const e=t.id,a=t.title,s=t.storageType;l.showDialog({title:"ç¡®è®¤åˆ é™¤",message:`ç¡®å®šè¦åˆ é™¤ã€Š${a}ã€‹å—ï¼Ÿ`,type:"warning",buttons:[{text:"å–æ¶ˆ"},{text:"åˆ é™¤",primary:!0,callback:async()=>{console.log("å¼€å§‹æ‰§è¡Œåˆ é™¤é€»è¾‘, ID:",e);try{await r.removeBook(e,s)?l.showSuccessDialog("ä¹¦ç±åˆ é™¤æˆåŠŸ"):l.showErrorDialog("åˆ é™¤å¤±è´¥","æ— æ³•åˆ é™¤æŒ‡å®šä¹¦ç±")}catch(d){console.error("åˆ é™¤è¿‡ç¨‹æŠ¥é”™:",d),l.showErrorDialog("åˆ é™¤å¤±è´¥",d instanceof Error?d.message:String(d))}}}]}),v()},ae=()=>{console.log("æ‰“å¼€åˆ†ç±»ç®¡ç†èœå•"),console.log("ä¸»èœå•ä½ç½®:",w.value,$.value),_.value=w.value+180,R.value=$.value,_.value+180>window.innerWidth&&(_.value=w.value-180),console.log("å­èœå•ä½ç½®:",_.value,R.value),T.value=!1,document.removeEventListener("click",v),setTimeout(()=>{M.value=!0,console.log("å­èœå•å·²æ˜¾ç¤º"),setTimeout(()=>{document.addEventListener("click",ne)},100)},50)},ne=t=>{const e=document.querySelector(".category-submenu");e&&!e.contains(t.target)&&v()},re=async t=>{if(!p.value){console.error("selectedBook ä¸º nullï¼Œæ— æ³•ç§»åŠ¨ä¹¦ç±");return}const e=p.value;console.log("ç§»åŠ¨ä¹¦ç±åˆ°åˆ†ç±»:",e.title,"->",t),console.log("selectedBook:",p.value);try{console.log("è°ƒç”¨ ebookStore.addBookToCategory");const a=await r.addBookToCategory(e.id,t);console.log("addBookToCategory è¿”å›ç»“æœ:",a),a?(l.showSuccessDialog("ä¹¦ç±åˆ†ç±»æ›´æ–°æˆåŠŸ"),v(),console.log("ä¹¦ç±åˆ†ç±»æ›´æ–°æˆåŠŸï¼Œèœå•å·²å…³é—­")):(l.showErrorDialog("åˆ†ç±»æ›´æ–°å¤±è´¥","æ— æ³•æ‰¾åˆ°æŒ‡å®šä¹¦ç±æˆ–åˆ†ç±»"),v(),console.log("ä¹¦ç±åˆ†ç±»æ›´æ–°å¤±è´¥ï¼Œèœå•å·²å…³é—­"))}catch(a){console.error("ç§»åŠ¨ä¹¦ç±åˆ°åˆ†ç±»å¤±è´¥:",a),l.showErrorDialog("åˆ†ç±»æ›´æ–°å¤±è´¥",a instanceof Error?a.message:String(a)),v()}},K=()=>{V.value=!0,y.value="",D.value="#4A90E2",v()},L=()=>{V.value=!1,y.value=""},ie=async()=>{if(y.value.trim()){console.log("å¼€å§‹åˆ›å»ºåˆ†ç±»ï¼Œåç§°:",y.value.trim(),"é¢œè‰²:",D.value);try{const t=await r.addCategory(y.value.trim(),D.value);console.log("åˆ†ç±»åˆ›å»ºæˆåŠŸï¼Œè¿”å›ç»“æœ:",t),await new Promise(e=>setTimeout(e,100)),console.log("å½“å‰åˆ†ç±»åˆ—è¡¨:",r.categories),console.log("åˆ†ç±»æ•°é‡:",r.categories.length),l.showSuccessDialog("åˆ†ç±»åˆ›å»ºæˆåŠŸ"),L()}catch(t){console.error("æ·»åŠ åˆ†ç±»å¤±è´¥:",t),l.showErrorDialog("åˆ†ç±»åˆ›å»ºå¤±è´¥",t instanceof Error?t.message:String(t))}}},j=async()=>{if(!m.value.trim()){N();return}x.value=!0;try{const t=await r.searchBooks(m.value.trim());f.value=t}catch(t){console.error("æœç´¢å¤±è´¥:",t),l.showErrorDialog("æœç´¢å¤±è´¥",t instanceof Error?t.message:String(t)),f.value=[]}finally{x.value=!1}},N=()=>{m.value="",f.value=[]},q=t=>{const e=r.categories.find(a=>a.id===t);return e?e.name:"æœªåˆ†ç±»"},ce=t=>r.books.filter(e=>e.categoryId===t);return ve(async()=>{try{console.log("é¦–é¡µåŠ è½½ï¼Œå¼€å§‹åˆå§‹åŒ–ç”µå­ä¹¦å­˜å‚¨..."),await r.initialize(),console.log("ç”µå­ä¹¦å­˜å‚¨åˆå§‹åŒ–å®Œæˆ"),console.log("å½“å‰ä¹¦ç±æ•°é‡:",r.books.length),console.log("å½“å‰åˆ†ç±»æ•°é‡:",r.categories.length)}catch(t){console.error("åˆå§‹åŒ–ç”µå­ä¹¦å­˜å‚¨å¤±è´¥:",t)}}),(t,e)=>{const a=ye("router-link");return u(),i("div",Ce,[o("header",we,[e[11]||(e[11]=o("h1",{class:"title"},"Neat Reader",-1)),o("div",_e,[o("div",De,[Y(o("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),placeholder:"æœç´¢ä¹¦åã€ä½œè€…",class:"search-input",onKeyup:ge(j,["enter"])},null,544),[[F,m.value]]),o("button",{class:"search-btn",onClick:j}," ğŸ” ")]),me(a,{to:"/settings",class:"btn btn-secondary"},{default:pe(()=>[...e[10]||(e[10]=[H(" è®¾ç½® ",-1)])]),_:1})])]),o("main",xe,[o("div",Ee,[o("div",Se,[o("button",{class:S(["category-tab",{active:g.value==="all"}]),onClick:e[1]||(e[1]=s=>g.value="all")}," å…¨éƒ¨ ",2),(u(!0),i(U,null,A(X.value,s=>(u(),i("button",{key:s.id,class:S(["category-tab",{active:g.value===s.id}]),style:B({borderColor:s.color}),onClick:d=>g.value=s.id},[H(c(s.name)+" ",1),o("span",Te,"("+c(ce(s.id).length)+")",1)],14,Be))),128)),o("button",{class:"category-tab add-category",onClick:K}," + æ–°å»ºåˆ†ç±» ")])]),o("div",Me,[o("div",$e,[o("h2",Ie,c(g.value==="all"?"æˆ‘çš„ä¹¦æ¶":q(g.value)),1),o("div",Re,[o("button",{class:S(["btn btn-secondary",{active:b.value==="grid"}]),onClick:e[2]||(e[2]=s=>b.value="grid")}," ç½‘æ ¼ ",2),o("button",{class:S(["btn btn-secondary",{active:b.value==="list"}]),onClick:e[3]||(e[3]=s=>b.value="list")}," åˆ—è¡¨ ",2)])]),x.value?(u(),i("div",Ve,[...e[12]||(e[12]=[o("div",{class:"loading-spinner"},null,-1),o("p",null,"æ­£åœ¨æœç´¢...",-1)])])):f.value.length>0&&m.value?(u(),i("div",Le,[o("p",null,"æ‰¾åˆ° "+c(f.value.length)+" ä¸ªç»“æœï¼Œå…³é”®è¯: "+c(m.value),1),o("button",{class:"btn btn-sm",onClick:N},"æ¸…é™¤æœç´¢")])):h("",!0),o("div",{class:S([b.value==="grid"?"grid":"list","books-list"])},[(u(!0),i(U,null,A(z.value,s=>(u(),i("div",{key:s.id,class:"book-item",onClick:d=>J(s.id),onContextmenu:k(d=>ee(d,s),["prevent"])},[o("div",{class:"book-cover",style:B({backgroundImage:`url(${s.cover})`})},[o("div",Ye,c(s.format.toUpperCase()),1),o("div",Fe,c(s.storageType==="local"?"ğŸ’»":"â˜ï¸"),1)],4),o("div",Ue,[o("h3",Ae,c(s.title),1),o("p",Pe,c(s.author),1),o("div",Xe,[o("div",ze,[o("div",{class:"progress-bar",style:B({width:`${s.readingProgress}%`})},null,4)]),o("span",Ke,c(s.readingProgress)+"%",1)]),o("p",je,c(Z(s.lastRead)),1),s.categoryId?(u(),i("div",qe,c(q(s.categoryId)),1)):h("",!0)])],40,Ne))),128))],2),z.value.length===0&&!x.value?(u(),i("div",He,[e[13]||(e[13]=o("div",{class:"empty-icon"},"ğŸ“š",-1)),o("h3",null,c(g.value==="all"?"ä¹¦æ¶æ˜¯ç©ºçš„":"è¯¥åˆ†ç±»ä¸‹æ²¡æœ‰ä¹¦ç±"),1),o("p",null,c(g.value==="all"?"æ·»åŠ ä¸€äº›ç”µå­ä¹¦å¼€å§‹é˜…è¯»å§":"ç‚¹å‡»å³ä¸Šè§’æ·»åŠ ä¹¦ç±"),1)])):h("",!0),f.value.length===0&&m.value&&!x.value?(u(),i("div",We,[e[14]||(e[14]=o("div",{class:"empty-icon"},"ğŸ”",-1)),e[15]||(e[15]=o("h3",null,"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ä¹¦ç±",-1)),e[16]||(e[16]=o("p",null,"å°è¯•å…¶ä»–å…³é”®è¯æˆ–æ£€æŸ¥æ‹¼å†™",-1)),o("button",{class:"btn btn-secondary",onClick:N},"æ¸…é™¤æœç´¢")])):h("",!0)])]),o("button",{class:"add-btn",onClick:O}," + "),o("input",{type:"file",ref_key:"fileInputRef",ref:C,onChange:Q,style:{display:"none"},accept:".epub,.pdf,.txt"},null,544),T.value?(u(),i("div",{key:0,class:"context-menu",style:B({left:w.value+"px",top:$.value+"px"}),onContextmenu:e[4]||(e[4]=k(()=>{},["prevent"]))},[o("div",{class:"menu-item",onClick:oe}," ğŸ“¤ ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜ "),o("div",{class:"menu-item",onClick:ae}," ğŸ“ åˆ†ç±»ç®¡ç† "),o("div",{class:"menu-item",onClick:te}," ğŸ—‘ï¸ åˆ é™¤ä¹¦ç± ")],36)):h("",!0),M.value?(u(),i("div",{key:1,class:"context-menu category-submenu",style:B({left:_.value+"px",top:R.value+"px"}),onClick:e[5]||(e[5]=k(()=>{},["stop"])),onContextmenu:e[6]||(e[6]=k(()=>{},["prevent"]))},[(u(!0),i(U,null,A(X.value,s=>(u(),i("div",{key:s.id,class:"menu-item",onClick:d=>re(s.id)},c(s.name),9,Ge))),128)),o("div",{class:"menu-item add-category",onClick:k(K,["stop"])}," + æ–°å»ºåˆ†ç±» ")],36)):h("",!0),V.value?(u(),i("div",{key:2,class:"dialog-overlay",onClick:L},[o("div",{class:"dialog-content",onClick:e[9]||(e[9]=k(()=>{},["stop"]))},[e[19]||(e[19]=o("h3",null,"æ–°å»ºåˆ†ç±»",-1)),o("div",Je,[o("div",Oe,[e[17]||(e[17]=o("label",null,"åˆ†ç±»åç§°",-1)),Y(o("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=s=>y.value=s),placeholder:"è¾“å…¥åˆ†ç±»åç§°",class:"form-input"},null,512),[[F,y.value]])]),o("div",Qe,[e[18]||(e[18]=o("label",null,"åˆ†ç±»é¢œè‰²",-1)),Y(o("input",{type:"color","onUpdate:modelValue":e[8]||(e[8]=s=>D.value=s),class:"color-picker"},null,512),[[F,D.value]])])]),o("div",Ze,[o("button",{class:"btn btn-secondary",onClick:L},"å–æ¶ˆ"),o("button",{class:"btn btn-primary",onClick:ie,disabled:!y.value.trim()},"åˆ›å»º",8,eo)])])])):h("",!0)])}}}),no=he(oo,[["__scopeId","data-v-7b2cec52"]]);export{no as default};
