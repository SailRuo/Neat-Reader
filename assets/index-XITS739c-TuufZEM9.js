import{s as N,u as P,o as R,F as C,Q as b,w as V,l as c,z as s,y as $,c as A,r as h,T as _,P as U,a as u,R as O,N as r,d as Q}from"./index-BXAhAS9o.js";import{j as J}from"./ebook-Bqqd_rdk-ozmTfELU.js";const K={class:"settings"},q={class:"header"},B={class:"main"},G={class:"settings-container"},H={class:"setting-section"},W={class:"setting-card"},X={class:"setting-row"},Y={class:"setting-info"},Z={key:0,class:"setting-desc"},L={key:1,class:"setting-desc"},ss={class:"setting-control"},as={class:"baidupan-status"},es={key:0,class:"status connected"},ts={key:1,class:"status disconnected"},ls={key:0,class:"setting-row"},ns={class:"setting-info",style:{width:"100%"}},is=["disabled"],os={key:1,class:"setting-row"},cs={class:"setting-info",style:{width:"100%"}},us={class:"user-info"},rs=["src"],vs={class:"user-detail"},ds={class:"user-name"},ps={class:"user-vip"},gs={class:"setting-section"},fs={class:"setting-card"},bs={class:"setting-row"},hs={class:"setting-info"},ms={class:"setting-desc"},ys={class:"setting-control"},ws={class:"stepper"},ks={class:"stepper-value"},Cs={class:"setting-row"},_s={class:"setting-control"},Us=["model-value"],Ss={class:"setting-row"},xs={class:"setting-control"},zs={class:"theme-selector"},Ds={class:"setting-row"},Ts={class:"setting-control"},Ms={class:"toggle-group"},js={class:"setting-section"},Es={class:"setting-card"},Fs={class:"setting-row"},Is={class:"setting-control"},Ns={class:"toggle-group"},Ps={class:"setting-row"},Rs={class:"setting-control"},Vs=["model-value"],$s=P({__name:"index",setup(As){const l=J(),v=R(),d=C(()=>l.userConfig.storage),t=C(()=>l.userConfig.reader),m=C(()=>l.userConfig.ui),p=b(""),g=b(""),o=b(""),y=b(""),f=b(!1),i=b(null),z=e=>{var a;const w=(a=e.clipboardData)==null?void 0:a.getData("text");w&&(o.value=w,e.preventDefault())},D=async()=>{if(!(!p.value||!g.value||!o.value)){f.value=!0;try{const e=await(await fetch("http://localhost:3001/api/baidu/oauth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:p.value,client_secret:g.value,refresh_token:o.value})})).json();e.success?(y.value=e.access_token,T()):v.showErrorDialog("获取失败",e.message)}catch{v.showErrorDialog("获取失败","网络错误，请重试")}finally{f.value=!1}}},T=async()=>{if(y.value){f.value=!0;try{const e=await(await fetch(`http://localhost:3001/api/baidu/pan/verify?token=${encodeURIComponent(y.value)}`)).json();e.valid?(i.value={baidu_name:e.user.baidu_name,avatar_url:e.user.avatar_url,vip_type:e.user.vip_type},await l.updateUserConfig({storage:{...d.value,baidupan:{...d.value.baidupan,accessToken:y.value,userId:String(e.user.uk),expiration:Date.now()+720*60*60*1e3}}}),v.showSuccessDialog("百度网盘授权成功")):v.showErrorDialog("验证失败",e.message||"无效的token")}catch{v.showErrorDialog("验证失败","网络错误，请重试")}finally{f.value=!1}}},M=async()=>{await l.updateUserConfig({storage:{...d.value,baidupan:{...d.value.baidupan,accessToken:"",userId:""}}}),i.value=null,o.value="",p.value="",g.value="",v.showSuccessDialog("已取消授权")},j=async()=>{t.value.fontSize>12&&await l.updateUserConfig({reader:{...t.value,fontSize:t.value.fontSize-1}})},E=async()=>{t.value.fontSize<32&&await l.updateUserConfig({reader:{...t.value,fontSize:t.value.fontSize+1}})},F=async e=>{const a=e.target;await l.updateUserConfig({reader:{...t.value,fontFamily:a.value}})},k=async e=>{await l.updateUserConfig({reader:{...t.value,theme:e}})},S=async e=>{await l.updateUserConfig({reader:{...t.value,pageMode:e}})},x=async e=>{await l.updateUserConfig({ui:{...m.value,viewMode:e}})},I=async e=>{const a=e.target;await l.updateUserConfig({ui:{...m.value,language:a.value}})};return V(async()=>{var e;if(await l.initialize(),(e=d.value.baidupan)!=null&&e.accessToken)try{const a=await(await fetch(`http://localhost:3001/api/baidu/pan/verify?token=${encodeURIComponent(d.value.baidupan.accessToken)}`)).json();a.valid&&(i.value={baidu_name:a.user.baidu_name,avatar_url:a.user.avatar_url,vip_type:a.user.vip_type})}catch{console.warn("验证已保存的token失败")}}),(e,a)=>{const w=O("router-link");return r(),c("div",K,[s("header",q,[a[11]||(a[11]=s("h1",{class:"title"},"设置",-1)),$(w,{to:"/",class:"btn btn-secondary"},{default:A(()=>[...a[10]||(a[10]=[Q("← 返回",-1)])]),_:1})]),s("main",B,[s("div",G,[s("section",H,[a[13]||(a[13]=s("h2",{class:"section-title"},"百度网盘",-1)),s("div",W,[s("div",X,[s("div",Y,[a[12]||(a[12]=s("span",{class:"setting-label"},"授权状态",-1)),i.value?(r(),c("span",Z,"已连接："+h(i.value.baidu_name),1)):(r(),c("span",L,"配置百度网盘信息以获取access_token"))]),s("div",ss,[s("div",as,[i.value?(r(),c("span",es,"已授权")):(r(),c("span",ts,"未授权"))])])]),i.value?(r(),c("div",os,[s("div",cs,[s("div",us,[s("img",{src:i.value.avatar_url,class:"user-avatar",alt:"头像"},null,8,rs),s("div",vs,[s("span",ds,h(i.value.baidu_name),1),s("span",ps,h(i.value.vip_type===2?"超级会员":i.value.vip_type===1?"普通会员":"普通用户"),1)])]),s("button",{class:"btn btn-danger",style:{width:"100%","margin-top":"12px"},onClick:M}," 取消授权 ")])])):(r(),c("div",ls,[s("div",ns,[_(s("input",{type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=n=>p.value=n),placeholder:"百度网盘 App Key",style:{width:"100%","margin-bottom":"12px"}},null,512),[[U,p.value]]),_(s("input",{type:"text",class:"form-control","onUpdate:modelValue":a[1]||(a[1]=n=>g.value=n),placeholder:"百度网盘 App Secret",style:{width:"100%","margin-bottom":"12px"}},null,512),[[U,g.value]]),_(s("input",{type:"text",class:"form-control","onUpdate:modelValue":a[2]||(a[2]=n=>o.value=n),placeholder:"Refresh Token",style:{width:"100%","margin-bottom":"12px"},onPaste:z},null,544),[[U,o.value]]),s("button",{class:"btn btn-primary",style:{width:"100%"},onClick:D,disabled:!p.value||!g.value||!o.value||f.value},h(f.value?"获取中...":"获取access_token"),9,is)])]))])]),s("section",gs,[a[19]||(a[19]=s("h2",{class:"section-title"},"阅读",-1)),s("div",fs,[s("div",bs,[s("div",hs,[a[14]||(a[14]=s("span",{class:"setting-label"},"字体大小",-1)),s("span",ms,"调整阅读时的字体大小 ("+h(t.value.fontSize)+"px)",1)]),s("div",ys,[s("div",ws,[s("button",{class:"btn btn-secondary btn-sm",onClick:j},"-"),s("span",ks,h(t.value.fontSize),1),s("button",{class:"btn btn-secondary btn-sm",onClick:E},"+")])])]),s("div",Cs,[a[16]||(a[16]=s("div",{class:"setting-info"},[s("span",{class:"setting-label"},"字体"),s("span",{class:"setting-desc"},"选择阅读时的字体")],-1)),s("div",_s,[s("select",{class:"form-control","model-value":t.value.fontFamily,onChange:F},[...a[15]||(a[15]=[s("option",{value:"system"},"系统默认",-1),s("option",{value:"sans-serif"},"无衬线体",-1),s("option",{value:"serif"},"衬线体",-1),s("option",{value:"monospace"},"等宽字体",-1)])],40,Us)])]),s("div",Ss,[a[17]||(a[17]=s("div",{class:"setting-info"},[s("span",{class:"setting-label"},"主题"),s("span",{class:"setting-desc"},"选择阅读界面的主题")],-1)),s("div",xs,[s("div",zs,[s("button",{class:u(["theme-btn light",{active:t.value.theme==="light"}]),onClick:a[3]||(a[3]=n=>k("light")),title:"浅色"},null,2),s("button",{class:u(["theme-btn sepia",{active:t.value.theme==="sepia"}]),onClick:a[4]||(a[4]=n=>k("sepia")),title:"护眼"},null,2),s("button",{class:u(["theme-btn dark",{active:t.value.theme==="dark"}]),onClick:a[5]||(a[5]=n=>k("dark")),title:"深色"},null,2)])])]),s("div",Ds,[a[18]||(a[18]=s("div",{class:"setting-info"},[s("span",{class:"setting-label"},"翻页模式"),s("span",{class:"setting-desc"},"选择翻页方式")],-1)),s("div",Ts,[s("div",Ms,[s("button",{class:u(["toggle-btn",{active:t.value.pageMode==="page"}]),onClick:a[6]||(a[6]=n=>S("page"))},"单页",2),s("button",{class:u(["toggle-btn",{active:t.value.pageMode==="scroll"}]),onClick:a[7]||(a[7]=n=>S("scroll"))},"滚动",2)])])])])]),s("section",js,[a[23]||(a[23]=s("h2",{class:"section-title"},"外观",-1)),s("div",Es,[s("div",Fs,[a[20]||(a[20]=s("div",{class:"setting-info"},[s("span",{class:"setting-label"},"视图模式"),s("span",{class:"setting-desc"},"书架的显示方式")],-1)),s("div",Is,[s("div",Ns,[s("button",{class:u(["toggle-btn",{active:m.value.viewMode==="grid"}]),onClick:a[8]||(a[8]=n=>x("grid"))},"网格",2),s("button",{class:u(["toggle-btn",{active:m.value.viewMode==="list"}]),onClick:a[9]||(a[9]=n=>x("list"))},"列表",2)])])]),s("div",Ps,[a[22]||(a[22]=s("div",{class:"setting-info"},[s("span",{class:"setting-label"},"语言"),s("span",{class:"setting-desc"},"界面语言")],-1)),s("div",Rs,[s("select",{class:"form-control","model-value":m.value.language,onChange:I},[...a[21]||(a[21]=[s("option",{value:"zh-CN"},"简体中文",-1),s("option",{value:"en-US"},"English",-1)])],40,Vs)])])])])])])])}}}),Js=N($s,[["__scopeId","data-v-cf885be6"]]);export{Js as default};
