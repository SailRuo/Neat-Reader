import{d as F,u as R,o as Y,c as i,a as s,b as L,w as N,n as k,F as P,r as V,e as y,f as w,g as x,h as d,i as z,j as X,k as c,t as u,l as j,m as H,_ as U}from"./index-yGnCnEuY.js";import{d as q}from"./dayjs.min-C0rw4Azs.js";import{u as A}from"./ebook-BQHR7Agd.js";const G={class:"home"},J={class:"header"},K={class:"header-actions"},O={class:"main"},Q={class:"books-section"},W={class:"section-header"},Z={class:"view-controls"},ee=["onClick","onContextmenu"],se={class:"book-format"},te={class:"book-storage"},oe={class:"book-info"},ne={class:"book-title"},ae={class:"book-author"},re={class:"book-progress"},le={class:"progress"},ie={class:"progress-text"},ce={class:"book-last-read"},de={key:0,class:"empty-state"},ue=F({__name:"index",setup(ve){const b=j(),v=A(),n=R(),p=d("grid"),g=d(null),h=d(!1),C=d(0),D=d(0),a=d(null),_=z(()=>v.books),E=t=>{b.push(`/reader/${t}`)},S=()=>{g.value&&g.value.click()},$=async t=>{var m;const r=(m=t.target.files)==null?void 0:m[0];if(!r)return;const o=r.name.toLowerCase().split(".").pop();if(!["epub","pdf","txt"].includes(o||"")){n.showErrorDialog("ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼","ä»…æ”¯æŒ EPUBã€PDF å’Œ TXT æ ¼å¼çš„ç”µå­ä¹¦");return}try{n.showDialog({title:"æ­£åœ¨å¯¼å…¥",message:`æ­£åœ¨å¯¼å…¥ ${r.name} ...`,type:"info",buttons:[]});const l=await v.importEbookFile(r);l?(n.closeDialog(),n.showSuccessDialog("å¯¼å…¥æˆåŠŸ"),b.push(`/reader/${l.id}`)):(n.closeDialog(),n.showErrorDialog("å¯¼å…¥å¤±è´¥","æ— æ³•å¯¼å…¥æ‰€é€‰æ–‡ä»¶"))}catch(l){n.closeDialog(),console.error("å¯¼å…¥æ–‡ä»¶å¤±è´¥:",l),n.showErrorDialog("å¯¼å…¥å¤±è´¥",l instanceof Error?l.message:String(l))}finally{g.value&&(g.value.value="")}},B=t=>q(t).format("YYYY-MM-DD HH:mm"),T=(t,e)=>{t.preventDefault(),h.value=!0,C.value=t.clientX,D.value=t.clientY,a.value=e,document.addEventListener("click",f)},f=()=>{h.value=!1,a.value=null,document.removeEventListener("click",f)},M=async t=>{if(t)try{await v.uploadLocalBookToBaidupan(t),n.showSuccessDialog("ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜æˆåŠŸ")}catch(e){console.error("ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜å¤±è´¥:",e),n.showErrorDialog("ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜å¤±è´¥",e instanceof Error?e.message:String(e))}finally{f()}},I=async t=>{t&&(n.showDialog({title:"ç¡®è®¤åˆ é™¤",message:`ç¡®å®šè¦åˆ é™¤ã€Š${t.title}ã€‹å—ï¼Ÿ`,type:"warning",buttons:[{text:"å–æ¶ˆ"},{text:"åˆ é™¤",primary:!0,callback:async()=>{try{const e=_.value.findIndex(o=>o.id===t.id);e!==-1&&console.log("æ‰¾åˆ°è¦åˆ é™¤çš„ä¹¦ç±ï¼Œç´¢å¼•:",e),await v.removeBook(t.id,t.storageType)?n.showSuccessDialog("ä¹¦ç±åˆ é™¤æˆåŠŸ"):n.showErrorDialog("åˆ é™¤ä¹¦ç±å¤±è´¥","æ— æ³•åˆ é™¤æŒ‡å®šä¹¦ç±")}catch(e){console.error("åˆ é™¤ä¹¦ç±å¤±è´¥:",e),n.showErrorDialog("åˆ é™¤ä¹¦ç±å¤±è´¥",e instanceof Error?e.message:String(e))}}}]}),f())};return Y(async()=>{await v.initialize()}),(t,e)=>{const r=X("router-link");return c(),i("div",G,[s("header",J,[e[7]||(e[7]=s("h1",{class:"title"},"Neat Reader",-1)),s("div",K,[L(r,{to:"/settings",class:"btn btn-secondary"},{default:N(()=>[...e[6]||(e[6]=[H(" è®¾ç½® ",-1)])]),_:1})])]),s("main",O,[s("div",Q,[s("div",W,[e[8]||(e[8]=s("h2",{class:"section-title"},"æˆ‘çš„ä¹¦æ¶",-1)),s("div",Z,[s("button",{class:k(["btn btn-secondary",{active:p.value==="grid"}]),onClick:e[0]||(e[0]=o=>p.value="grid")}," ç½‘æ ¼ ",2),s("button",{class:k(["btn btn-secondary",{active:p.value==="list"}]),onClick:e[1]||(e[1]=o=>p.value="list")}," åˆ—è¡¨ ",2)])]),s("div",{class:k([p.value==="grid"?"grid":"list","books-list"])},[(c(!0),i(P,null,V(_.value,o=>(c(),i("div",{key:o.id,class:"book-item",onClick:m=>E(o.id),onContextmenu:w(m=>T(m,o),["prevent"])},[s("div",{class:"book-cover",style:x({backgroundImage:`url(${o.cover})`})},[s("div",se,u(o.format.toUpperCase()),1),s("div",te,u(o.storageType==="local"?"ğŸ’»":"â˜ï¸"),1)],4),s("div",oe,[s("h3",ne,u(o.title),1),s("p",ae,u(o.author),1),s("div",re,[s("div",le,[s("div",{class:"progress-bar",style:x({width:`${o.readingProgress}%`})},null,4)]),s("span",ie,u(o.readingProgress)+"%",1)]),s("p",ce,u(B(o.lastRead)),1)])],40,ee))),128))],2),_.value.length===0?(c(),i("div",de,[...e[9]||(e[9]=[s("div",{class:"empty-icon"},"ğŸ“š",-1),s("h3",null,"ä¹¦æ¶æ˜¯ç©ºçš„",-1),s("p",null,"æ·»åŠ ä¸€äº›ç”µå­ä¹¦å¼€å§‹é˜…è¯»å§",-1)])])):y("",!0)])]),s("button",{class:"add-btn",onClick:S}," + "),s("input",{type:"file",ref_key:"fileInputRef",ref:g,onChange:$,style:{display:"none"},accept:".epub,.pdf,.txt"},null,544),h.value?(c(),i("div",{key:0,class:"context-menu",style:x({left:C.value+"px",top:D.value+"px"}),onClick:e[4]||(e[4]=w(()=>{},["stop"])),onContextmenu:e[5]||(e[5]=w(()=>{},["prevent"]))},[a.value&&a.value.storageType==="local"?(c(),i("div",{key:0,class:"menu-item",onClick:e[2]||(e[2]=o=>M(a.value))}," ğŸ“¤ ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜ ")):y("",!0),a.value?(c(),i("div",{key:1,class:"menu-item",onClick:e[3]||(e[3]=o=>I(a.value))}," ğŸ—‘ï¸ åˆ é™¤ä¹¦ç± ")):y("",!0)],36)):y("",!0)])}}}),fe=U(ue,[["__scopeId","data-v-a2dbd9dd"]]);export{fe as default};
