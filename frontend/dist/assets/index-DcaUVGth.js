import{d as p,g,c as n,a as c,t as i,r as d,x as _,o as t,_ as h}from"./index-xevC7b_N.js";const m={class:"callback"},b={class:"callback-content"},f=p({__name:"index",setup(v){const l=_(),e=d("loading"),a=d("正在处理授权，请稍候..."),u=async()=>{try{console.log("=== Callback 页面：开始处理授权回调 ==="),console.log("当前URL:",window.location.href);const o=new URLSearchParams(window.location.search).get("code");if(console.log("提取到的code:",o),!o)throw new Error("未获取到授权码");console.log("尝试发送code给主窗口..."),window.opener?(console.log("✓ 检测到 window.opener，发送 postMessage"),window.opener.postMessage({type:"baidu-auth-code",code:o},window.location.origin)):window.parent!==window?(console.log("✓ 检测到父窗口，发送 postMessage"),window.parent.postMessage({type:"baidu-auth-code",code:o},window.location.origin)):(console.log("✗ 未检测到父窗口，存储到 localStorage"),localStorage.setItem("baidupan_auth_code",o)),e.value="success",a.value=`授权成功！授权码: ${o}

窗口将在3秒后自动关闭...`,setTimeout(()=>{r()},3e3)}catch(s){console.error("处理授权回调失败:",s),e.value="error",a.value=`授权失败: ${s instanceof Error?s.message:"未知错误"}`}},r=()=>{window.opener?window.close():l.push("/")},w=()=>{l.push("/")};return g(()=>{u()}),(s,o)=>(t(),n("div",m,[c("div",b,[c("h1",null,i(e.value==="loading"?"处理中...":e.value==="success"?"授权成功":"授权失败"),1),c("p",null,i(a.value),1),e.value==="success"?(t(),n("button",{key:0,class:"btn btn-primary",onClick:r}," 关闭窗口 ")):(t(),n("button",{key:1,class:"btn btn-secondary",onClick:w}," 返回首页 "))])]))}}),y=h(f,[["__scopeId","data-v-88d6e3f3"]]);export{y as default};
