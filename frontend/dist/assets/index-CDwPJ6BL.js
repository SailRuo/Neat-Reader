import{d as m,o as b,b as c,e as l,t as p,r as g,D as f,j as r,_ as k}from"./index-DA789M3t.js";const v={class:"callback"},y={class:"callback-content"},C=m({__name:"index",setup(x){const i=f(),s=g("loading"),a=g("正在处理授权，请稍候..."),_=async()=>{try{console.log("=== Callback 页面：开始处理授权回调 ==="),console.log("当前URL:",window.location.href);const e=new URLSearchParams(window.location.search),o=e.get("code"),n=e.get("state");if(console.log("提取到的code:",o),console.log("提取到的state:",n),!o)throw new Error("未获取到授权码");const t=window.location.pathname.includes("qwen-callback"),u=t?"qwen-auth-code":"baidu-auth-code";if(console.log("回调类型:",t?"Qwen":"百度网盘"),console.log("尝试发送code给主窗口..."),window.opener)console.log("✓ 检测到 window.opener，发送 postMessage"),window.opener.postMessage({type:u,code:o,state:n},window.location.origin);else if(window.parent!==window)console.log("✓ 检测到父窗口，发送 postMessage"),window.parent.postMessage({type:u,code:o,state:n},window.location.origin);else{console.log("✗ 未检测到父窗口，存储到 localStorage");const w=t?"qwen_auth_code":"baidupan_auth_code";localStorage.setItem(w,o),n&&localStorage.setItem(`${w}_state`,n)}s.value="success",a.value=`授权成功！授权码: ${o}

窗口将在3秒后自动关闭...`,setTimeout(()=>{d()},3e3)}catch(e){console.error("处理授权回调失败:",e),s.value="error",a.value=`授权失败: ${e instanceof Error?e.message:"未知错误"}`}},d=()=>{window.opener?window.close():i.push("/")},h=()=>{i.push("/")};return b(()=>{_()}),(e,o)=>(r(),c("div",v,[l("div",y,[l("h1",null,p(s.value==="loading"?"处理中...":s.value==="success"?"授权成功":"授权失败"),1),l("p",null,p(a.value),1),s.value==="success"?(r(),c("button",{key:0,class:"btn btn-primary",onClick:d}," 关闭窗口 ")):(r(),c("button",{key:1,class:"btn btn-secondary",onClick:h}," 返回首页 "))])]))}}),S=k(C,[["__scopeId","data-v-07a83278"]]);export{S as default};
