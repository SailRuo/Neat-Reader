const u=({entries:l,loadBlob:i,getSize:a},d)=>{const r=new Map,s=new Map,p=async e=>{if(r.has(e))return r.get(e);const o=URL.createObjectURL(await i(e)),c=URL.createObjectURL(new Blob([`<body style="margin: 0"><img src="${o}">`],{type:"text/html"}));return s.set(e,[o,c]),r.set(e,c),c},f=e=>{s.get(e)?.forEach?.(o=>URL.revokeObjectURL(o)),s.delete(e),r.delete(e)},g=[".jpg",".jpeg",".png",".gif",".bmp",".webp",".svg",".jxl",".avif"],n=l.map(e=>e.filename).filter(e=>g.some(o=>e.endsWith(o))).sort();if(!n.length)throw new Error("No supported image files in archive");const t={};return t.getCover=()=>i(n[0]),t.metadata={title:d.name},t.sections=n.map(e=>({id:e,load:()=>p(e),unload:()=>f(e),size:a(e)})),t.toc=n.map(e=>({label:e,href:e})),t.rendition={layout:"pre-paginated"},t.resolveHref=e=>({index:t.sections.findIndex(o=>o.id===e)}),t.splitTOCHref=e=>[e,null],t.getTOCFragment=e=>e.documentElement,t.destroy=()=>{for(const e of s.values())for(const o of e)URL.revokeObjectURL(o)},t};export{u as makeComicBook};
